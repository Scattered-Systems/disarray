.cargo_test_template: &cargo_test
  stage: testing
  script:
    - sudo apt install -y protobuf-compiler && sudo update -y && rustup default nightly
    - cargo test --all-features --release --verbose --jobs 1
  
stages:
  - testing

stable:cargo:
  image: rustdocker/rust:stable
  rules:
    - if: '$CI_COMMIT_TAG =~ /^v[0-9]+\.[0-9]+\.[0-9]+$/'
  <<: *cargo_test
